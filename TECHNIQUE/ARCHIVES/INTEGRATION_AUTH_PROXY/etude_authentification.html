
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://uepal-civiparoisse-documentation.github.io/index.html/TECHNIQUE/ARCHIVES/INTEGRATION_AUTH_PROXY/etude_authentification.html">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.13">
    
    
      
        <title>Etude : Authentification Apache / CiviCRM - Documentation UEPAL Civiparoisse</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#etude-authentification-apache-civicrm" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="En-tÃªte">
    <a href="../../../index.html" title="Documentation UEPAL Civiparoisse" class="md-header__button md-logo" aria-label="Documentation UEPAL Civiparoisse" data-md-component="logo">
      
  <img src="../../../assets/uepal-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation UEPAL Civiparoisse
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Etude : Authentification Apache / CiviCRM
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Recherche">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Partager" aria-label="Partager" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Effacer" aria-label="Effacer" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initialisation de la recherche
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Onglets" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../index.html" class="md-tabs__link">
        
  
  
    
  
  Documentation Civiparoisse

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../UTILISATION/mode_emploi/index.html" class="md-tabs__link">
          
  
  
    
  
  Mode d'emploi

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../PRESENTATION/index.html" class="md-tabs__link">
          
  
  
    
  
  PrÃ©sentation du projet

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../index.html" class="md-tabs__link">
          
  
  
    
  
  ElÃ©ments techniques

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../FORMATION/index.html" class="md-tabs__link">
          
  
  
    
  
  Formation

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../index.html" title="Documentation UEPAL Civiparoisse" class="md-nav__button md-logo" aria-label="Documentation UEPAL Civiparoisse" data-md-component="logo">
      
  <img src="../../../assets/uepal-logo.svg" alt="logo">

    </a>
    Documentation UEPAL Civiparoisse
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Documentation Civiparoisse
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../UTILISATION/mode_emploi/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Mode d'emploi
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Mode d'emploi
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/introduction.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/debuter.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DÃ©buter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/fiches_contact.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GÃ©rer les fiches
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/relations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GÃ©rer les relations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/liens_paroisses.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GÃ©rer les liens avec la paroisse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/faire_des_recherches_sur_les_contacts.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Faire des recherches sur les contacts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/envoyer_un_courriel.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Envoyer un courriel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/groupes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GÃ©rer les groupes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/listes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utiliser les listes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/que_faire_quand.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Que faire quand... ?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/gestion_des_dons_et_edition_des_recus_fiscaux.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Gestion des dons et Ã©dition des reÃ§us fiscaux
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/creer_et_gerer_un_evenement.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CrÃ©er et gÃ©rer un Ã©vÃ©nement
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/operations_a_mener_regulierement.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpÃ©rations Ã  mener rÃ©guliÃ¨rement
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/gestion_base_donnees.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Administration locale de la base de donnÃ©es
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/prepaper_installation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrÃ©parer l'installation initiale de CiviParoisse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/nouveautes_CiviParoisse.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Les nouveautÃ©s dans CiviParoisse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../UTILISATION/mode_emploi/ressources.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ressources utiles
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../PRESENTATION/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    PrÃ©sentation du projet
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            PrÃ©sentation du projet
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PRESENTATION/presentation_fonctionnelle.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PÃ©rimÃ¨tre fonctionnel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PRESENTATION/presentation_ecosysteme.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EcosystÃ¨me projet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../PRESENTATION/presentation_livrables.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Livrables
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    ElÃ©ments techniques
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            ElÃ©ments techniques
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../EXPLOITATION/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Exploitation
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Exploitation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../EXPLOITATION/logs.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../POC/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    POC
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            POC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../POC/remontage_local.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remontage en local
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../PREPOC/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    PRE_POC
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            PRE_POC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/prepoc.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Description gÃ©nÃ©rale
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../PREPOC/ETUDES_PRECIS/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Etudes - prÃ©cis techniques
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4_3" id="__nav_4_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_3">
            <span class="md-nav__icon md-icon"></span>
            Etudes - prÃ©cis techniques
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/ETUDES_PRECIS/infrastructure.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Infrastructure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/ETUDES_PRECIS/trafic_entrant.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trafic initiateur entrant
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/ETUDES_PRECIS/traefik.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Maquettage Traefik
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/ETUDES_PRECIS/identites_certificats.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IdentitÃ©s et certificats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/ETUDES_PRECIS/waf.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Web Application Firewall
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/ETUDES_PRECIS/integration_ca.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    IntÃ©gration CA Ubuntu
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/ETUDES_PRECIS/minikube_traefik_wildcard.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Minikube + Traefik + Wildcard
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../PREPOC/INTEGRATION/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    OpÃ©rationnel
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4_4" id="__nav_4_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_4">
            <span class="md-nav__icon md-icon"></span>
            OpÃ©rationnel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/deploiement_instance.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DÃ©ploiement instance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Description gÃ©nÃ©rale Docker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../PREPOC/INTEGRATION/DOCKER/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Images Docker
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4_4_4" id="__nav_4_4_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_4_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_4_4">
            <span class="md-nav__icon md-icon"></span>
            Images Docker
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/selfkeys.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    selfkeys
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/keys_init.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    keys_init
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/mysql_tls_router.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mysql_tls_router
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/mysql_tls_server.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mysql_tls_server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/composer_base.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    composer_base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/composer_files.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    composer_files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/tools.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/tools_debug" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tools_debug
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/init.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    init
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/cron.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cron
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/httpd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    httpd
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/httpd_debug.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    httpd_debug
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/update.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    update
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/test_msmtp_dovecot.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    test_msmtp_dovecot
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/gen_hashed_ca.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gen_hashed_ca
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/DOCKER/traefik_docker.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    traefik_docker
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../PREPOC/INTEGRATION/KUBERNETES/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Kubernetes
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4_4_5" id="__nav_4_4_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_4_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_4_5">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/KUBERNETES/maquettage.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Maquettage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/KUBERNETES/ressources.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ressources utiles
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_4_5_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../PREPOC/INTEGRATION/KUBERNETES/HELM/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Chart Helm
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4_4_5_4" id="__nav_4_4_4_5_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_4_4_4_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_4_5_4">
            <span class="md-nav__icon md-icon"></span>
            Chart Helm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/KUBERNETES/HELM/description_generale.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Description gÃ©nÃ©rale
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/KUBERNETES/HELM/db_dbrouter.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    DB et DB Router
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/KUBERNETES/HELM/httpd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Serveur web interne
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/KUBERNETES/HELM/cron.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cron
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/KUBERNETES/HELM/volumes.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Volumes (persistants)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/KUBERNETES/HELM/secrets.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Secrets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/KUBERNETES/HELM/reservations.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RÃ©servations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/KUBERNETES/HELM/maildemo.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Serveur mail de dÃ©mo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PREPOC/INTEGRATION/KUBERNETES/HELM/tools.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Outils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../roles.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RÃ´les
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../MAIL/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Mail
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Mail
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MAIL/mail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ProblÃ©matique
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MAIL/ecosysteme.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EcosystÃ¨me
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MAIL/sendmail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Envoi
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MAIL/fetchmail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RÃ©ception
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MAIL/opensmtpd_dovecot.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Opensmtpd Dovecot
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../LOGICIEL/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Logiciel
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Logiciel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LOGICIEL/distribution_code_composer.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Distribution de code
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LOGICIEL/environnement_dev.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environnement de dev
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LOGICIEL/environnement_dev_env.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Personnalisation environnement de dev
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../LOGICIEL/importation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Importation de donnÃ©es
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../INTEGRATION_CONTINUE/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    IntÃ©gration Continue
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            IntÃ©gration Continue
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INTEGRATION_CONTINUE/docker_build_push.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker build et push
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INTEGRATION_CONTINUE/tests_automatises.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tests automatisÃ©s : Codeception
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INTEGRATION_CONTINUE/tests_phpunit.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tests automatisÃ©s : Phpunit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INTEGRATION_CONTINUE/composer_ci.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Composer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INTEGRATION_CONTINUE/trivy_ci.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trivy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INTEGRATION_CONTINUE/sonarqube_ci.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SonarLint et SonarQube
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    ARCHIVES
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            ARCHIVES
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../FORMATION/index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Formation
    
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Formation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="etude-authentification-apache-civicrm"><a class="toclink" href="#etude-authentification-apache-civicrm">Etude : Authentification Apache / CiviCRM</a></h1>
<p>Documentation archivÃ©e le 1er mai 2023.</p>
<p>Lâauthentification de CiviCRM peut correspondre Ã  deux notions, qui ne se recoupent pas
forcÃ©ment :</p>
<ul>
<li>lâutilisateur qui est loguÃ© dans le CMS : on se base alors sur les mÃ©canismes du CMS, qui
peuvent Ãªtre diffÃ©rents en fonction des CMS</li>
<li>le contact enregistrÃ© dans le CRM : ce protocole permet Ã©galement de reconnaÃ®tre comme utilisateur CiviCRM un contact. Par ailleurs, Authx dispose Ã©galement dâune page qui expose lâidentification de lâutilisateur courant (/civicrm/authx/id), page qui a Ã©galement lâavantage dâÃªtre lÃ©gÃ¨re Ã  charger.</li>
</ul>
<p>Dans le cadre du projet CiviParoisse, il nâest pas souhaitable, pour des questions de sÃ©curitÃ© et de confidentialitÃ© des donnÃ©es, quâun contact sans compte dans le CMS puisse interagir avec le CRM. Il sâagira donc de faire en sorte que seuls les utilisateurs loguÃ©s dans le CMS puissent avoir un accÃ¨s au systÃ¨me.</p>
<p>LâaccÃ¨s au CMS devra dâailleurs Ãªtre compris de maniÃ¨re assez large : en effet, si on considÃ¨re des documents qui sont stockÃ©s sous formes de fichiers directement accessibles via Apache, le CMS ne sera pas chargÃ© pour lâaccÃ¨s Ã  ces fichiers et donc le contrÃ´le dâaccÃ¨s que pourrait effectuer le CMS ne se fera pas. Or, les contrÃ´les sont Ã©galement requis sur ces fichiers. Il sâagit donc dâeffectuer une authentification directement au niveau du serveur web.</p>
<p>Pour autant, le processus doit rester simple pour les utilisateurs finaux : il sâagit donc de ne pas leur demander de retenir trop de mots de passe : il faut donc que lâauthentification effectuÃ©e au niveau de Apache puisse Ãªtre propagÃ©e au CMS. Toutefois, Ã©tant donnÃ© que les utilisateurs pourraient choisir des mots de passe simple (ou les Ã©crire sur des morceaux de papier), il convient de proposer une authentification Ã  2 facteurs, par exemple en se basant non seulement sur une connaissance (le mot de passe), mais Ã©galement une possession (un certificat SSL, voire un token de sÃ©curitÃ©).</p>
<p>Le travail Ã  effectuer est donc assez complexe, et a nÃ©cessitÃ© des recherches poussÃ©es. Ce travail peut se diviser en deux parties, lâune concernant lâauthentification par mot de passe, et lâautre concernant lâauthentification par certificat SSL et HSM ; en revanche, il faudra Ã©galement veiller Ã  la correspondance des identitÃ©s entre les deux mÃ©thodes (ne pas autoriser le certificat dâun utilisateur A et le mot de passe dâun utilisateur B lors dâun seul login).</p>
<h2 id="authentification-par-mot-de-passe"><a class="toclink" href="#authentification-par-mot-de-passe">Authentification par mot de passe</a></h2>
<h3 id="le-choix-du-cms-drupal"><a class="toclink" href="#le-choix-du-cms-drupal">Le choix du CMS : Drupal</a></h3>
<p>Lâauthentification par mot de passe est gÃ©rÃ©e par le CMS. CiviCRM propose un support de 4 CMS (Drupal, Backdrop, Wordpress et Joomla). Ces CMS proposent tous nativement une authentification par nom dâutilisateur et mot de passe, avec un hash salÃ© du mot de passe stockÃ© en base de donnÃ©es. De la sorte, si la base de donnÃ©es fuite, les mots de passe ne sont pas pour autant prÃ©sents, car les fonctions de hash cherchent Ã  Ãªtre des fonctions Ã  sens unique qui ne permettent pas de prÃ©dire des collisions de hashes (lorsque cela arrive, la fonction ne peut plus Ãªtre utilisÃ©e comme fonction de sÃ©curitÃ©). Les fonctions de hashes utilisÃ©es peuvent diffÃ©rer, mais il semble que la plupart des CMS supportent les hashes calculÃ©s par le code du projet phpass (<a href="https://www.openwall.com/phpass/">https://www.openwall.com/phpass/</a>). On notera toutefois que la page du projet indique quâil faudrait prÃ©fÃ©rer lâutilisation des fonctions natives de PHP 5.5 et ultÃ©rieur.</p>
<p>MÃªme si lâon observe une certaine unicitÃ© de maniÃ¨re de faire chez les CMS supportÃ©s, la nÃ©cessitÃ© de dÃ©finir le CMS qui sera utilisÃ© arrive quand mÃªme rapidement, puisquâil sâagira dâimplÃ©menter un SSO entre le serveur web et le CMS. Les recherches effectuÃ©es ont conduit Ã  privilÃ©gier Drupal, pour plusieurs raisons :</p>
<ul>
<li>
<p>les recherches sur les procÃ©dures dâinstallation ont montrÃ© lâintÃ©rÃªt, pour lâautomatisation de lâinstallation et la mise Ã  jour des systÃ¨mes, de disposer dâun gestionnaire de versions. Or, CiviCRM utilise Composer, qui est Ã©galement utilisÃ© par Drupal. A lâinverse, Backdrop et Wordpress ne semblent pas intÃ©grer officiellement la gestion des dÃ©pendances via
Composer. Au niveau de Joomla, le support de Composer est souhaitÃ© et intÃ©grÃ© dans la feuille de route, mais nâest pas encore atteint.</p>
</li>
<li>
<p>Drupal utilise le framework Symfony, et ce framework dispose dâun support
dâauthentification HTTP Basic : le systÃ¨me intÃ¨gre donc dÃ©jÃ  des composants qui faciliteront le SSO entre le serveur web et le CMS</p>
</li>
<li>
<p>le projet CiviParoisse est historiquement basÃ© sur le CMS Drupal ; les bÃ©nÃ©voles qui travaillent sur les aspects techniques ont de ce fait cherchÃ© Ã  remonter en local des instances Drupal + CiviCRM, dâoÃ¹ une Ã©ventuelle rÃ©utilisation ou montÃ©e en compÃ©tences sur ce CMS</p>
</li>
<li>
<p>il semblerait que CiviCRM ait des affinitÃ©s avec Drupal (comme par exemple les conventions de code qui ont Ã©tÃ© rÃ©utilisÃ©es).</p>
</li>
</ul>
<h3 id="le-choix-du-serveur-web-apache"><a class="toclink" href="#le-choix-du-serveur-web-apache">Le choix du serveur web : Apache</a></h3>
<p>Le choix du serveur web est Ã©galement un choix important, car il en existe un grand nombre (Apache, Nginx, Jetty, Lighttpd pour ne citer quâeux). Apache est le serveur web qui est traditionnellement employÃ© Â« par dÃ©faut Â» dans les sites web PHP (stack LAMP ou WAMP, avec A pour Apache), et de ce fait est susceptible dâÃªtre mieux connu par les bÃ©nÃ©voles que les autres
solutions. De ce fait, mÃªme si dâautres serveurs pourraient Ã©ventuellement Ãªtre employÃ©s, la recherche sâest concentrÃ©e sur lâinterfaÃ§age avec Apache. Toutefois, si le besoin se fait sentir, on pourra chercher Ã  se tourner vers dâautres solutions (dont Nginx).</p>
<h3 id="strategie-dinterfacage"><a class="toclink" href="#strategie-dinterfacage">StratÃ©gie dâinterfaÃ§age</a></h3>
<p>La stratÃ©gie dâinterfaÃ§age va chercher Ã  utiliser au maximum les codes existants pour dÃ©velopper (et maintenir) un minimum de mÃ©canismes spÃ©cifiques. De ce fait, deux axes vont Ãªtre mis en Åuvre :</p>
<ul>
<li>
<p>la consommation des identifiants prÃ©sentÃ©s par Apache Ã  Drupal pour disposer dâun mÃ©canisme SSO.</p>
</li>
<li>
<p>la mise Ã  disposition Ã  Apache dâun mÃ©canisme de validation des donnÃ©es dâauthentification, mÃ©canisme fourni par Drupal ou CiviCRM (authx)</p>
</li>
</ul>
<h4 id="consommation-des-identifiants-presentes-par-apache-a-drupal"><a class="toclink" href="#consommation-des-identifiants-presentes-par-apache-a-drupal">Consommation des identifiants prÃ©sentÃ©s par Apache Ã  Drupal</a></h4>
<p>La consommation des donnÃ©es dâauthentification prÃ©sentÃ©es par Apache Ã  du code PHP est assez standardisÃ©e : traditionnellement, le serveur Apache peut fournir une variable dâenvironnement <code>REMOTE_USER</code> pour indiquer lâidentifiant dâun utilisateur, si lâauthentification a Ã©tÃ© effectuÃ©e au niveau dâApache. Lorsquâil sâagit dâune authentification de type HTTP Basic, les donnÃ©es sont prÃ©sentÃ©es Ã©galement Ã  PHP via les variables <code>$_SERVER['PHP_AUTH_USER']</code> et <code>$_SERVER[âPHP_AUTH_PWâ]</code>.</p>
<p>Comme on le verra plus tard, Apache nâest pas en mesure de vÃ©rifier de faÃ§on autonome les donnÃ©es dâidentification, et devra se reposer sur Drupal et PHP pour faire le travail via de lâauthentification de type HTTP Basic. Cette authentification de type HTTP Basic sera transmise avec chaque requÃªte de page.</p>
<p>Le HTTP Basic est supportÃ© via Symfony, mais nâest pas considÃ©rÃ© comme une mÃ©thode dâauthentification globale (utilisable tout le temps par dÃ©faut, Ã  lâinverse de lâauthentification par cookie). Il sâagit donc au niveau de Drupal de crÃ©er un petit module qui permet dâinjecter le fournisseur HTTP Basic comme un fournisseur global via un fichier <nom_module>.services.yml :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">services</span><span class="p">:</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nt">basic_auth.authentication.basic_auth</span><span class="p">:</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Drupal\basic_auth\Authentication\Provider\BasicAuth</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nt">arguments</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">&#39;@config.factory&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;@user.auth&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;@flood&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;@entity_type.manager&#39;</span><span class="w"> </span><span class="p p-Indicator">]</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nt">tags</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt"> name</span><span class="p">:</span><span class="w"> </span><span class="nv">authentication_provider</span><span class="p p-Indicator">,</span><span class="nt"> provider_id</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;basic_auth&#39;</span><span class="p p-Indicator">,</span><span class="nt"> priority</span><span class="p">:</span><span class="w"> </span><span class="nv">100</span><span class="p p-Indicator">,</span><span class="nt"> global</span><span class="p">:</span><span class="w"> </span><span class="nv">TRUE</span><span class="w"> </span><span class="p p-Indicator">}</span>
</code></pre></div>
<p>Câest le seul rÃ©glage Ã  effectuer pour consommer les donnÃ©es. Si les donnÃ©es dâauthentification ne sont pas juste, une erreur de type 4XX est renvoyÃ©e. <strong>En revanche, il reste Ã  la charge dâApache de toujours envoyer les donnÃ©es dâidentification pour quâelles soient consommÃ©es (le header HTTP Authorization : Basic devra Ãªtre prÃ©sent dans toutes les requÃªtes), sans quoi un code 200 pourrait Ãªtre renvoyÃ© Ã  tort.</strong></p>
<h4 id="mise-a-disposition-des-donnees-dauthentification"><a class="toclink" href="#mise-a-disposition-des-donnees-dauthentification">Mise Ã  disposition des donnÃ©es dâauthentification</a></h4>
<p>Apache sÃ©pare conceptuellement le processus dâauthentification en deux, Ã  savoir les mÃ©canismes permettant de rÃ©cupÃ©rer les donnÃ©es dâidentification fournies par un navigateur web dâune part, et la comparaison avec des fournisseurs dâauthentification dâautre part.</p>
<h5 id="fournisseur-authnz-external"><a class="toclink" href="#fournisseur-authnz-external">Fournisseur Authnz External</a></h5>
<p>En ce qui concerne le fournisseur dâauthentification, Apache propose plusieurs mÃ©thodes. Malheureusement, aucune mÃ©thode Â« native Â» ne convient, car la mÃ©thode reposant sur lâexploitation dâune base de donnÃ©es suppose la connaissance de la mÃ©thode de hash pour que le hash puisse Ãªtre calculÃ© sur les donnÃ©es brutes.</p>
<p>En ce qui concerne le support FastCGI, bien que celui-ci soit sÃ©duisant sur le papier, le support FastCGI proposÃ© par php (php-cgi) et par fpm (php-fpm) nâa pas permis dâobtenir un fonctionnement tel quâun script dÃ©fini sur la ligne de commande soit exÃ©cutÃ© et que le fastcgi ne soit utilisÃ© que pour fournir les donnÃ©es dâauthentification. Il aurait donc fallu se tourner vers dâautres implÃ©mentations FastCGI, ce qui aurait supposÃ© des dÃ©veloppements et donc la maintenance de ces dÃ©veloppements.</p>
<p>En revanche, il existe un fournisseur tiers qui est le module <code>authnz_external</code>. Ce module tiers est disponible directement dans les packages de Ubuntu LTS, et de ce fait son support est assurÃ© via la distribution. Ce module permet lâexÃ©cution dâun programme externe, auquel on peut fournir parplusieurs moyens les donnÃ©es dâidentification. Le module utilisera le code de retour du programme pour dÃ©terminer si lâauthentification a rÃ©ussi (code de retour Ã  zÃ©ro) ou Ã©chouÃ© (code de retour diffÃ©rent de zÃ©ro).</p>
<p>Comme on lâa vu prÃ©cÃ©demment dans le SSO dâApache vers Drupal, en envoyant une requÃªte HTTP vers Drupal avec de lâauthentification Basic fournira un code de retour qui indiquera si lâauthentification a rÃ©ussi ou non. Il va donc sâagir dâutiliser un programme tiers pour rÃ©cupÃ©rer les identifiants, effectuer la requÃªte, et renvoyer le bon code de retour, en sâassurant que lâidentifiant et le mot de passe soient toujours settÃ©s dans la requÃªte.</p>
<h5 id="script-shell-principal-wget-script-askpass"><a class="toclink" href="#script-shell-principal-wget-script-askpass">Script shell principal, wget, script askpass</a></h5>
<p>La commande wget est une commande dâutilisation assez commune, qui permet dâeffectuer en particulier une requÃªte HTTP. Cette commande supporte le HTTPS (en authentification et en vÃ©rification du certificat serveur), et propose via lâoption âuse-askpass lâutilisation dâun programme Â« askpass Â» tiers pour fournir les informations dâidentification via STDOUT (une exÃ©cution du programme tiers pour le nom dâutilisateur, une autre pour le mot de passe). Charge au programme askpass de rÃ©cupÃ©rer le mot de passe, de vÃ©rifier sa longueur, et de le retransmettre via STDOUT sâil est non vide. Ce programme askpass devra soigner son code de retour : 0 si tout va bien ou une valeur diffÃ©rente sâil y a un problÃ¨me. DâaprÃ¨s mes tests, le code de retour de askpass est pris en compte par wget, et sâil est diffÃ©rent de 0, wget rÃ©agira Ã©galement dans son code de retour . Ce point est dâailleurs plus ou moins confirmÃ© par la lecture du code source et lâexemple dans la page man de posix_spawnp (utilisÃ© pour lancer le programme) :</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1">//Code source wget : main.c :</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">use_askpass</span><span class="p">;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">question</span><span class="p">;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">posix_spawnp</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">use_askpass</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fa</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">argv</span><span class="p">,</span><span class="w"> </span><span class="n">environ</span><span class="p">);</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="p">{</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="n">fprintf</span><span class="w"> </span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Error spawning %s: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">use_askpass</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="n">exit</span><span class="w"> </span><span class="p">(</span><span class="n">WGET_EXIT_GENERIC_ERROR</span><span class="p">);</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="p">}</span>
</code></pre></div>
Exemple dans la man page:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>The program below demonstrates the use of various functions in the POSIX spawn API. The program accepts command-line attributes that can be used to create file actions and attributes objects. The remaining command-line arguments are used as the executable name and command-line arguments of the program that is executed in the child.
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>In the first run, the date(1) command is executed in the child, and the posix_spawn() call employs no file actions or attributes objects.
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>$ ./a.out date
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>PID of child: 7634
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>Tue Feb 1 19:47:50 CEST 2011
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>Child status: exited, status=0
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>In the next run, the -c command-line option is used to create a file actions object that closes standard output in the child. Consequently, date(1) fails when trying to perform output and exits with a status of 1.
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>$ ./a.out -c date
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>PID of child: 7636
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>date: write error: Bad file descriptor
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>Child status: exited, status=1
</code></pre></div>
<p><strong>Par ailleurs, wget permet via lâoption âauth-no-challenge dâenvoyer directement lâauthentification HTTP Basic sans requÃ©rir le challenge initial : ce point est trÃ¨s important,dans la mesure oÃ¹ une page sans authentification pourrait renvoyer Ã©galement du code 200, comme vu prÃ©cÃ©demment dans lâimplÃ©mentation SSO.</strong></p>
<p>On se souviendra quâÃ©tant donnÃ© quâUnix crÃ©e des processus par fork, les descripteurs de fichiers disponibles dans un processus pÃ¨re sont Ã©galement dupliquÃ©s dans un processus fils au niveau du fork. En lâoccurence, mod_authnz_external permet de transmettre via la mÃ©thode Â« pipe Â» les donnÃ©es via STDIN, et le fork effectuÃ© par mod_authnz_external, puis le script shell principal, puis par le script wget font que le script askpass pourra lire chaque donnÃ©e sur STDIN. Cette maniÃ¨re de faire a un gros avantage : les donnÃ©es dâidentification ne seront pas prÃ©sentes dans lâenvironnement des applications, et de ce fait ne peuvent pas Ãªtre rÃ©cupÃ©rÃ©es aussi facilement que via de lâexÃ©cution de commande ps ou des balades dans /proc.</p>
<p>On en arrive donc aux Ã©bauches suivantes :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="ch">#!/bin/bash</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="c1"># Script shell Askpass :</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nb">read</span><span class="w"> </span>-s<span class="w"> </span>t
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$t</span><span class="s2">&quot;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="k">then</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$t</span><span class="s2">&quot;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="k">else</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="k">fi</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>#!/bin/bash
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>#Script shell Principal :
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>wget -d --use-askpass=&quot;/home/ubuntu/DRUPAL_COMPOSER2/AUTH/askpass.sh&quot;
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>--auth-no-challenge --
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>certificate=&quot;/etc/apache2/KEYS/server.x509&quot;
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>--private-key=&quot;/etc/apache2/KEYS/server.key&quot;
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>--ca-
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>certificate=&quot;/etc/apache2/KEYS/ca.x509&quot; https://drucomp2.test:444/civicrm/authx/id -O /dev/null
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>exit $?
</code></pre></div>
<p>Bien entendu, ces scripts peuvent encore Ãªtre amÃ©liorÃ©s (par exemple vÃ©rifier le code de retour des read), rendus plus gÃ©nÃ©riques pour lâinstallation automatique, utiliser des clefs spÃ©cifiquesâ¦</p>
<h5 id="cible-pour-lauthentification-authx"><a class="toclink" href="#cible-pour-lauthentification-authx">Cible pour lâauthentification : authx</a></h5>
<p>A vrai dire, nâimporte quelle page authentifiÃ©e pourrait faire lâaffaire en tant que cible (du moment quâelle ne modifie pas le systÃ¨me). Pour autant, jâai vu deux cibles plus intÃ©ressantes que les autres, en raison des informations quâelles peuvent fournir pour du dÃ©bogage ; en effet, elles indiquent toutes les deux si lâutilisateur est loguÃ© :</p>
<ul>
<li>civicrm/authx/id : intÃ©grÃ© dans CiviCRM</li>
<li>user/login_status?_format=xml : intÃ©grÃ© dans Drupal.</li>
</ul>
<p>LâintÃ©rÃªt de authx est quâil fournit des informations supplÃ©mentaires par rapport Ã  lâÃ©ventuel contact associÃ© Ã  lâutilisateur.</p>
<p>En outre, il faut configurer authx, en fonction des indications donnÃ©es dans le guide du dÃ©veloppeur CiviCRM :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>cv.phar<span class="w"> </span>ev<span class="w"> </span><span class="s1">&#39;Civi::settings()-&gt;set(&quot;authx_guards&quot;,[&quot;perm&quot;]);&#39;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>cv.phar<span class="w"> </span>ev<span class="w"> </span><span class="s1">&#39;Civi::settings()-&gt;set(&quot;authx_param_cred&quot;,[]);&#39;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>cv.phar<span class="w"> </span>ev<span class="w"> </span><span class="s1">&#39;Civi::settings()-&gt;set(&quot;authx_param_user&quot;,&quot;require&quot;);&#39;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>cv.phar<span class="w"> </span>ev<span class="w"> </span><span class="s1">&#39;Civi::settings()-&gt;set(&quot;authx_header_cred&quot;,[&quot;pass&quot;]);&#39;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>cv.phar<span class="w"> </span>ev<span class="w"> </span><span class="s1">&#39;Civi::settings()-&gt;set(&quot;authx_header_user&quot;,&quot;require&quot;);&#39;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>cv.phar<span class="w"> </span>ev<span class="w"> </span><span class="s1">&#39;Civi::settings()-&gt;set(&quot;authx_xheader_cred&quot;,[]);&#39;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>cv.phar<span class="w"> </span>ev<span class="w"> </span><span class="s1">&#39;Civi::settings()-&gt;set(&quot;authx_xheader_user&quot;,&quot;require&quot;);&#39;</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>cv.phar<span class="w"> </span>ev<span class="w"> </span><span class="s1">&#39;Civi::settings()-&gt;set(&quot;authx_login_cred&quot;,[]);&#39;</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>cv.phar<span class="w"> </span>ev<span class="w"> </span><span class="s1">&#39;Civi::settings()-&gt;set(&quot;authx_login_user&quot;,&quot;require&quot;);&#39;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>cv.phar<span class="w"> </span>ev<span class="w"> </span><span class="s1">&#39;Civi::settings()-&gt;set(&quot;authx_auto_cred&quot;,[]);&#39;</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>cv.phar<span class="w"> </span>ev<span class="w"> </span><span class="s1">&#39;Civi::settings()-&gt;set(&quot;authx_auto_user&quot;,&quot;require&quot;);&#39;</span>
</code></pre></div>
<h3 id="configuration-apache-mise-en-uvre-dun-reverse-proxy-et-authentification-a-deux-facteurs-ssl-et-basic"><a class="toclink" href="#configuration-apache-mise-en-uvre-dun-reverse-proxy-et-authentification-a-deux-facteurs-ssl-et-basic">Configuration Apache : mise en Åuvre dâun reverse proxy et authentification Ã  deux facteurs (SSL et basic)</a></h3>
<p>Les tests ont montrÃ© trÃ¨s rapidement un problÃ¨me Ã  rÃ©soudre lorsquâon utilise quâun seul site : si Apache cherche Ã  sâinterroger lui-mÃªme sur la validitÃ© dâune page, on arrive Ã  une boucle rÃ©cursive qui fait exploser le nombre de requÃªtes wget, et la requÃªte ne peut donc pas aboutir.</p>
<p>Le moyen le plus simple pour rÃ©gler ce problÃ¨me est de faire reposer lâauthentification SSO non pas directement sur le virtualhost de Drupal, mais plutÃ´t sur un reverse proxy se plaÃ§ant en amont : il suffit par exemple dâouvrir un autre port pour le virtualhost de Drupal, mais sur 127.0.0.1, de sorte Ã  ce que le virtualhost ne soit pas directement accessible depuis lâextÃ©rieur (par exemple : 127.0.0.1:444/tcp). Le reverse proxy, lui, va Ã©couter sur 0.0.0.0:443/tcp.</p>
<p>Cette configuration, outre le fait de rÃ©gler le problÃ¨me de boucle, pourrait Ã©galement se rÃ©vÃ©ler utile pour isoler le pÃ©rimÃ¨tre dâun problÃ¨me : en effet, un administrateur pourra Ã©ventuellement faire du port forwarding via SSH pour accÃ©der Ã  distance au port 444 si nÃ©cessaire (Ã  condition quâil se connecte Ã  distance Ã  la machine). On peut Ã©ventuellement chercher Ã  limiter cette possibilitÃ© en instaurant une authentification par certificat entre le reverse proxy et le virtualhost drupal. Par ailleurs, le fait dâutiliser du SSL pour cette connexion interne permet Ã©galement dâÃ©viter de laisser circuler en clair des mots de passe qui pourraient Ãªtre capturÃ©s via tcpdump par exemple. Un autre type de solution technique qui aurait fait Ã©galement lâaffaire aurait Ã©tÃ© de lâIPSEC en mode transport : nÃ©anmoins, il semble plus maintenable dâutiliser du SSL, tout simplement car des connaissances sur ce sujet sont plus ou moins dÃ©jÃ  exigÃ©es du fait de la nÃ©cessitÃ© actuelle de la mise en Åuvre de HTTPS.</p>
<p>On en arrive Ã  une Ã©bauche de configuration telle que suit. Cette Ã©bauche pourra Ãªtre amÃ©liorÃ©e en dÃ©diant une autoritÃ© de certification dâune part aux connexions des clients vers le reverse proxy et dâautre part Ã  la connexion entre le reverse proxy et le vhost Drupal.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">Listen</span><span class="w"> </span><span class="m">127.0.0.1</span>:444
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nt">&lt;VirtualHost</span><span class="w"> </span><span class="s">127.0.0.1:443</span><span class="nt">&gt;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="c">#LogLevel debug</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="c">#CustomLog &quot;/var/log/apache2/debug_jm.log&quot; &quot;REMOTE_USER: %{REMOTE_USER}x {SSL_CLIENT_S_DN_CN}x --- %v %h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot;</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="nb">ServerName</span><span class="w"> </span>drucomp2.test
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="nb">AddExternalAuth</span><span class="w"> </span>dea<span class="w"> </span><span class="s2">&quot;/home/ubuntu/DRUPAL_COMPOSER2/AUTH/externalauth.sh&quot;</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="nb">SetExternalAuthMethod</span><span class="w"> </span>dea<span class="w"> </span>pipe
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="nb">SSLEngine</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="nb">SSLCACertificateFile</span><span class="w"> </span><span class="s2">&quot;/etc/apache2/KEYS/ca.x509&quot;</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="nb">SSLCertificateFile</span><span class="w"> </span><span class="s2">&quot;/etc/apache2/KEYS/drucomp2.x509&quot;</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="nb">SSLCertificateKeyFile</span><span class="w"> </span><span class="s2">&quot;/etc/apache2/KEYS/drucomp2.pem&quot;</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="nb">SSLCipherSuite</span><span class="w"> </span>HIGH:!aNULL:!MD5
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="nb">SSLOptions</span><span class="w"> </span>+StrictRequire
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="nb">SSLProxyVerify</span><span class="w"> </span>require
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="nb">SSLProxyMachineCertificateFile</span><span class="w"> </span><span class="s2">&quot;/etc/apache2/KEYS/proxy_client.pem&quot;</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="nb">SSLProxyCACertificateFile</span><span class="w"> </span><span class="s2">&quot;/etc/apache2/KEYS/ca.x509&quot;</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="nt">&lt;Location</span><span class="w"> </span><span class="s">/</span><span class="nt">&gt;</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="nt">&lt;RequireAll&gt;</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="nb">Require</span><span class="w"> </span>ssl
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="nb">Require</span><span class="w"> </span>ssl-verify-client
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="nb">Require</span><span class="w"> </span>valid-user
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="nb">Require</span><span class="w"> </span>expr<span class="w"> </span>(%{REMOTE_USER}<span class="w"> </span>==<span class="w"> </span>%{SSL_CLIENT_S_DN_CN}<span class="w"> </span>)<span class="w"> </span>&amp;&amp;<span class="w"> </span>(-n<span class="w"> </span>%{REMOTE_USER})
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="nt">&lt;/RequireAll&gt;</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="nb">AuthType</span><span class="w"> </span>Basic
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="nb">AuthName</span><span class="w"> </span><span class="s2">&quot;Apache Level&quot;</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="nb">AuthBasicProvider</span><span class="w"> </span>external
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="nb">AuthExternal</span><span class="w"> </span>dea
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="nb">AuthBasicAuthoritative</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="nb">ProxyPass</span><span class="w"> </span><span class="s2">&quot;https://drucomp2.test:444/&quot;</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="nb">ProxyPassReverse</span><span class="w"> </span><span class="s2">&quot;https://drucomp2.test:444/&quot;</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="nt">&lt;/Location&gt;</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="nb">SSLProxyCheckPeerCN</span><span class="w"> </span><span class="k">On</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="nb">SSLProxyCheckPeerName</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="nb">SSLProxyVerify</span><span class="w"> </span>require
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="nb">SSLProxyEngine</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="nb">SSLOptions</span><span class="w"> </span>+StrictRequire
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="nb">SSLVerifyClient</span><span class="w"> </span>require
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="nt">&lt;/VirtualHost&gt;</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="nt">&lt;VirtualHost</span><span class="w"> </span><span class="s">127.0.0.1:444</span><span class="nt">&gt;</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="c">#LogLevel debug</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="nb">DocumentRoot</span><span class="w"> </span><span class="sx">/home/ubuntu/DRUPAL_COMPOSER2</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="nb">ServerName</span><span class="w"> </span>drucomp2.test
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="nb">php_admin_value</span><span class="w"> </span>sendmail_path<span class="w"> </span><span class="s2">&quot;/usr/bin/env catchmail -f test@mailcatcher.test&quot;</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="nb">php_admin_value</span><span class="w"> </span>CIVICRM_DB_CACHE_CLASS<span class="w"> </span>NoCache
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="nt">&lt;Directory</span><span class="w"> </span><span class="s">/home/ubuntu/DRUPAL_COMPOSER2</span><span class="nt">&gt;</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="nb">SSLRequireSSL</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="nb">Require</span><span class="w"> </span><span class="k">all</span><span class="w"> </span>granted
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="nb">AllowOverride</span><span class="w"> </span><span class="k">All</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="nt">&lt;/Directory&gt;</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="nb">SSLEngine</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="nb">SSLCACertificateFile</span><span class="w"> </span><span class="s2">&quot;/etc/apache2/KEYS/ca.x509&quot;</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="nb">SSLCertificateFile</span><span class="w"> </span><span class="s2">&quot;/etc/apache2/KEYS/drucomp2.x509&quot;</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="nb">SSLCertificateKeyFile</span><span class="w"> </span><span class="s2">&quot;/etc/apache2/KEYS/drucomp2.pem&quot;</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="nb">SSLCipherSuite</span><span class="w"> </span>HIGH:!aNULL:!MD5
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="nb">SSLOptions</span><span class="w"> </span>+StrictRequire
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="nb">SSLVerifyClient</span><span class="w"> </span>require
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="nt">&lt;/VirtualHost&gt;</span>
</code></pre></div>
<p>Cette configuration prÃ©sente par ailleurs dÃ©jÃ  une configuration pour forcer une authentification par certificat SSL, avec une vÃ©rification particuliÃ¨re : la vÃ©rification de la correspondance entre lâutilisateur authentifiÃ© via mod_external ( dans <code>REMOTE_USER</code> ) et le common name du distinguished name du certificat SSL du client ( <code>SSL_CLIENT_S_DN_CN</code> ). A nouveau, on prend la prÃ©caution de vÃ©rifier que lâidentifiant nâest pas vide, mÃªme si cela ne devrait pas arriver vu les prÃ©cautions prises dans le askpass.</p>
<p>A lâusage, avec les caches dÃ©sactivÃ©s, on constate immÃ©diatement une grosse augmentation de charge systÃ¨me lors de la mise en Åuvre : en effet, pour toute requÃªte entrante, il y a en rÃ©alitÃ© trois requÃªtes exÃ©cutÃ©es (requÃªte entrante, requÃªte dâautorisation, requÃªte de traitement). Il faut voir que cette configuration empÃªche Ã©galement certaines mises en cache au niveau de Drupal, mises en caches qui sont interdites nativement en raison de lâauthentification basique.</p>
<h2 id="authentification-par-clef-privee-et-certificat-ssl-sur-hsm"><a class="toclink" href="#authentification-par-clef-privee-et-certificat-ssl-sur-hsm">Authentification par clef privÃ©e (et certificat SSL) sur HSM</a></h2>
<p>Lâauthentification par clef privÃ©e et certificat SSL sur Hardware Security Module est un moyen pour fournir une authentification matÃ©rielle, dans la mesure oÃ¹, en gÃ©nÃ©ral, les modules de sÃ©curitÃ© permettent de gÃ©nÃ©rer des clefs privÃ©es, mais ne permettent pas de les exporter (certains modules permettent toutefois une sauvegarde chiffrÃ©e de la clef privÃ©e). Le module peut prendre plusieurs formes, dont usuellement la forme dâun token USB, similaire Ã  une clef USB. Les fonctionnalitÃ©s qui seront utilisÃ©es sur ces clefs sont les fonctionnalitÃ©s PIV (Personnal Identity Verification). GÃ©nÃ©ralement, les constructeurs de telles clefs fournissent des API pour accÃ©der au matÃ©riel, qui implÃ©mentent le support de PKCS11. Câest justement sur la mise en Åuvre de PKCS11 dans le serveur web que va reposer en grande partie lâauthentification par clef, Ã  la place des fichiers de clefs.</p>
<h3 id="une-contrainte-lourde-la-gestion-dune-autorite-de-certification"><a class="toclink" href="#une-contrainte-lourde-la-gestion-dune-autorite-de-certification">Une contrainte lourde : la gestion dâune autoritÃ© de certification</a></h3>
<p>Cette authentification par clef et certificat suppose une gestion des clefs rigoureuse, et implique une contrainte relativement forte : la mise en Åuvre dâune infrastructure Ã  clefs publiques (Public Key Infrastructure). Cette infrastructure suppose au minimum la prÃ©sence dâune autoritÃ© de certification (CA) qui est un tiers de confiance qui va attester de lâidentitÃ© liÃ©e Ã  une clef publique. LâautoritÃ© de certification doit Ãªtre gÃ©rÃ©e de maniÃ¨re rigoureuse pour que la confiance subsiste, et requiert donc la mise en Åuvre de processus organisationnels formalisÃ©s, compris, et acceptÃ©s par toutes les parties.</p>
<p>Le travail de lâautoritÃ© de certification est non seulement la signature des certificats, mais Ã©galement la rÃ©vocation des clefs compromises (Certificate Revocation List, accessible soit sous forme de fichier, soit sous forme de service de rÃ©pondeur OCSP Online Certificate Status Protocol) ). Ce travail de rÃ©vocation nÃ©cessite une disponibilitÃ© trÃ¨s rapide de lâautoritÃ©, en plus de la coopÃ©ration des utilisateurs.</p>
<p>La mise en Åuvre dâune autoritÃ© de certification internalisÃ©e est donc un prÃ©requis lourd quâil ne faut pas sous-estimer. Il existe de la littÃ©rature spÃ©cialisÃ©e Ã  ce sujet. Il y a Ã©ventuellement une autre piste complÃ©mentaire : sâadresser Ã  lâANSSI (ex :
<a href="https://www.ssi.gouv.fr/uploads/2015/07/catalogue-cfssi-anssi_2020-2021.pdf">https://www.ssi.gouv.fr/uploads/2015/07/catalogue-cfssi-anssi_2020-2021.pdf</a> ) ou aux services du ministÃ¨re de lâintÃ©rieur si une Â« externalisation Â» pourrait Ãªtre envisagÃ©e.</p>
<h3 id="preparation-dun-hsm-deux-exemples"><a class="toclink" href="#preparation-dun-hsm-deux-exemples">PrÃ©paration dâun HSM : deux exemples</a></h3>
<p>Deux exemples peuvent Ãªtre explorÃ©s : lâutilisation dâune clef usb Yubikey (ex:Yubikey 4), et lâutilisation dâune implÃ©mentation dâÃ©mulation logicielle : SoftHSM(v2). LâintÃ©rÃªt de lâÃ©mulation est quâil peut servir Ã  modÃ©liser les services sur les machines de dÃ©velopp ement sans disposer de matÃ©riel particulier.</p>
<h4 id="clef-yubikey"><a class="toclink" href="#clef-yubikey">Clef Yubikey</a></h4>
<p>Lâexemple de la clef Yubikey nâest pas un exemple Â« anodin Â», dans la mesure oÃ¹ Yubico (<a href="https://www.yubico.com/?lang=fr">https://www.yubico.com/?lang=fr</a>) supporte lâenvironnement Linux (les packages de gestion des Yubikeys sont disponibles en standard dans Ubuntu) et fournit une documentation sur son site web (<a href="https://developers.yubico.com/PIV/">https://developers.yubico.com/PIV/</a>). Les prix des clefs sur le site de Yubico semblent accessibles (<a href="https://www.yubico.com/fr/store/">https://www.yubico.com/fr/store/</a> : Ã  partir de 45â¬HT pour une clef). Jâai une clef Yubikey 4 que jâavais achetÃ©e il y a plusieurs annÃ©es pour expÃ©rimenter. </p>
<p>La premiÃ¨re chose Ã  faire serait dâabord de personnaliser les codes dâaccÃ¨s de la clef. Deux codes sont gÃ©nÃ©ralement utilisables : le PIN utilisateur et le PIN de lâofficier de sÃ©curitÃ© (ou code PUK). Par ailleurs, dans le cadre de la clef Yubikey, personnaliser la clef de Management serait Ã©galement judicieux (voir <a href="https://developers.yubico.com/PIV/Introduction/Admin_access.html">https://developers.yubico.com/PIV/Introduction/Admin_access.html</a> ). Je nâai nÃ©anmoins pas effectuÃ© ces tÃ¢ches.</p>
<p>Les fonctionnalitÃ©s PIV sont gÃ©rÃ©es par un outil spÃ©cifique : <code>yubico-piv-tool</code>, qui est un outil en ligne de commande. La premiÃ¨re chose est de gÃ©nÃ©rer un couple clef publique / clef privÃ©e pour lâusage dâauthentification. Ces clefs Ã©tant multi-usages, il convient tout dâabord de dÃ©terminer l'emplacement mÃ©moire (slot) qui devra Ãªtre utilisÃ©, en se rÃ©fÃ©rant Ã  la documentation (<a href="https://developers.yubico.com/PIV/Introduction/Certificate_slots.html">https://developers.yubico.com/PIV/Introduction/Certificate_slots.html</a>) : ledit slot est le 9a. Lâoutil
yubico-piv-tool permettrait par ailleurs Ã©galement de changer pin, puk et clef de management. Un autre outil permet de configurer les fonctionnalitÃ©s disponibles : <code>ykman</code>, et permet explicitement de lister les pÃ©riphÃ©riques et les services activÃ©s.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>yubico-piv-tool<span class="w"> </span>-a<span class="w"> </span>generate<span class="w"> </span>-s<span class="w"> </span>9a<span class="w"> </span>-A<span class="w"> </span>RSA2048
</code></pre></div>
La commande affiche ensuite la clef publique gÃ©nÃ©rÃ©e. On peut la retrouver via la gÃ©nÃ©ration dâune requÃªte de certificat, qui est lâÃ©tape suivante :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>yubico-piv-tool<span class="w"> </span>-a<span class="w"> </span>verify-pin<span class="w"> </span>-a<span class="w"> </span>request-certificate<span class="w"> </span>-s<span class="w"> </span>9a<span class="w"> </span>-S<span class="s1">&#39;/CN=admin/OU=test/O=drucomp2.test&#39;</span><span class="w"> </span>-o<span class="w"> </span>cert.req
</code></pre></div>
<p>On notera la syntaxe du sujet du certificat, qui utilise des slashes Ã  la place des virgules.</p>
<p>On peut ensuite signer la requÃªte de certificat, comme par exemple avec :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-in<span class="w"> </span>YUBICO/cert.req<span class="w"> </span>-out<span class="w"> </span>YUBICO/cert.x509<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-CA<span class="w"> </span>ca.x509<span class="w"> </span>-CAkey<span class="w"> </span>ca.key<span class="w"> </span>-CAserial<span class="w"> </span>ca.srl
</code></pre></div>
<p>Il nây a ensuite plus quâÃ  importer le certificat :</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>yubico-piv-tool<span class="w"> </span>-s9a<span class="w"> </span>-aimport-certificate<span class="w"> </span>-i<span class="w"> </span>cert.x509
</code></pre></div>
A ce moment, la clef est prÃªte pour attester dâune identitÃ© â Ã  condition de faire confiance Ã  lâautoritÃ© de certification qui a signÃ© le certificat.</p>
<h4 id="softhsm2"><a class="toclink" href="#softhsm2">SoftHSM2</a></h4>
<p>SoftHSM2 permet de fournir une Ã©mulation de matÃ©riel de sÃ©curitÃ©, utile pour apprendre. NÃ©anmoins, le fait que ce soit une Ã©mulation logicielle a un impact important : les droits sur les fichiers sâappliquent, ce qui nâest pas le cas avec du matÃ©riel : ceci a posÃ© problÃ¨me pour lâaccÃ¨s aux clefs via apache, lorsque www-data nâavait pas les droits sur les fichiers, en lanÃ§ant une erreur assez gÃ©nÃ©rique (object invalid handle). Le dÃ©buggage de ce problÃ¨me a nÃ©cessitÃ© lâinstallation des symboles de dÃ©buggage dâapache, la modification du nombre de workers (pour passer Ã  1), et la
rÃ©cupÃ©ration des codes sources des librairies (via apt source) pour pouvoir attacher Ã  gdb le worker apache et faire du pas Ã  pas dans le code source pour arriver jusquâÃ  la source du problÃ¨me.</p>
<p>La mise en Åuvre de SoftHSM2 est assez ressemblante Ã  celle de la Yubikey. La premiÃ¨re des choses est dâidentifier les slots disponibles :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>softhsm2-util--show-slots
</code></pre></div>
<p>De lÃ , il faut initialiser les pins de lâutilisateur et du security officer :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>softhsm2-util<span class="w"> </span>--init-token<span class="w"> </span>--slot<span class="w"> </span><span class="m">0</span><span class="w"> </span>--so-pin<span class="w"> </span><span class="m">12345678</span><span class="w"> </span>--pin<span class="w"> </span><span class="m">123456</span><span class="w"> </span>--label<span class="w"> </span>serverhsm
</code></pre></div>
<p>GÃ©nÃ©rer la paire de clefs : on utilise pkcs11-tool (package opensc)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>pkcs11-tool<span class="w"> </span>--module<span class="w"> </span>/usr/lib/arm-linux-gnueabihf/softhsm/libsofthsm2.so<span class="w"> </span>--login<span class="w"> </span>--keypairgen<span class="w"> </span>--key-type<span class="w"> </span>rsa:2048<span class="w"> </span>--usage-sign<span class="w"> </span>--token-label<span class="w"> </span>serverhsm<span class="w"> </span>--label<span class="w"> </span>serverkey
</code></pre></div>
<p>De lÃ , il faut trouver lâURI PKCS11 de la clef utilisÃ©e : p11tool (package gnutls-bin) : on rÃ©cupÃ¨re dâabord la liste des tokens, avec leur URI, puis on liste celles du support qui nous intÃ©resse</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>p11tool<span class="w"> </span>--list-tokens
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>p11tool<span class="w"> </span>--login<span class="w"> </span>--list-all<span class="w"> </span>pkcs11:model<span class="o">=</span>SoftHSM%20v2<span class="p">;</span><span class="nv">manufacturer</span><span class="o">=</span>SoftHSM%20project<span class="p">;</span><span class="nv">serial</span><span class="o">=</span>75bb53774ddd60dc<span class="p">;</span><span class="nv">token</span><span class="o">=</span>serverhsm
</code></pre></div>
<p>GÃ©nÃ©rer la requÃªte de certificat :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-engine<span class="w"> </span>pkcs11<span class="w"> </span>-keyform<span class="w"> </span>engine<span class="w"> </span>-key<span class="w"> </span><span class="s2">&quot;pkcs11:model=SoftHSM%20v2;manufacturer=SoftHSM%20project;serial=75bb53774ddd60dc;token=serverhsm;object=serverkey;type=private&quot;</span><span class="w"> </span>-subj<span class="w"> </span><span class="s2">&quot;/C=FR/ST=France/L=Strasbourg/O=TEST/OU=INFRA/CN=drucomp2.test&quot;</span><span class="w"> </span>-out<span class="w"> </span>serverhsm.req
</code></pre></div>
<p>Il ne reste plus que la signature du certificat :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-in<span class="w"> </span>serverhsm.req<span class="w"> </span>-out<span class="w"> </span>serverhsm.x509<span class="w"> </span>-extfile<span class="w"> </span>ext<span class="w"> </span>-ext<span class="w"> </span>ext<span class="w"> </span>-CA<span class="w"> </span>ca.x509<span class="w"> </span>-CAkey<span class="w"> </span>ca.key<span class="w"> </span>-CAserial<span class="w"> </span>ca.srl<span class="w"> </span>-sha256<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span>
</code></pre></div>
<p>Et lâimport du certificat :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>pkcs11-tool<span class="w"> </span>--module<span class="w"> </span>/usr/lib/arm-linux-gnueabihf/softhsm/libsofthsm2.so<span class="w"> </span>serverhsm<span class="w"> </span>--label<span class="w"> </span>servercert<span class="w"> </span>--write-object<span class="w"> </span>serverhsm.x509<span class="w"> </span>--type<span class="w"> </span>cert<span class="w"> </span>--login<span class="w"> </span>--token-label
</code></pre></div>
<p>Comme indiquÃ© prÃ©cÃ©demment, il faudra faire attention Ã  ce que les fichiers soient accessibles par lâutilisateur qui les utilisera.</p>
<h3 id="mise-en-uvre-du-hsm-pour-les-connexions-web"><a class="toclink" href="#mise-en-uvre-du-hsm-pour-les-connexions-web">Mise en Åuvre du HSM pour les connexions web</a></h3>
<p>Le HSM va Ãªtre utilisÃ© Ã  deux endroits : au niveau du serveur web, et au niveau du navigateur web.</p>
<h4 id="prise-en-charge-par-apache"><a class="toclink" href="#prise-en-charge-par-apache">Prise en charge par Apache</a></h4>
<p>Apache dispose de deux supports pour la prise en charge de PKCS11 : le premier support est le module gnutls. Ce module est dÃ©jÃ  ancien, et les tests effectuÃ©s montrent que ce module ne met pas Ã  disposition les donnÃ©es comme le DN du sujet du certificat au niveau des directives Require : de ce fait, ce module ne peut pas faire lâaffaire.</p>
<p>Le deuxiÃ¨me module est le module ssl : ce module a vu un dÃ©but de support de PKCS11 depuis la version 2.4.42. Ce support est donc rÃ©cent, car la version dâApache fournie par Ubuntu 20.04 LTS est la version 2.4.41, ne permettant pas le support de la fonctionnalitÃ©. De ce fait, il est nÃ©cessaire de passer temporairement Ã  la version 21.04 dâUbuntu, qui embarque Apache 2.4.46 ; passer Ã  la version normale signifie Ã©galement disposer dâune durÃ©e de support rÃ©duite Ã  9 mois, au lieu de 5 ans.</p>
<p>Le support est minimaliste : il concerne le certificat et la clef du serveur : les directives de configuration peuvent accepter depuis 2.4.42 de la possibilitÃ© de saisir des URI PKCS11, URI que lâon peut dÃ©terminer via p11tool. Ce point est problÃ©matique pour le reverse proxy, qui, lui, ne
supporte pas dâURI PKCS11 au niveau de la directive <code>SSLProxyMachineCertificateFile</code>. On arrive Ã  comprendre ce non-support en raison de lâapproche de cette directive : stocker lâensemble des certificats dans un path ou dans un fichier pour permettre au proxy de sâauthentifier auprÃ¨s des serveurs distants, ce qui est incompatible avec les URI PKCS11, qui, elles, sont plutÃ´t utilisÃ©es pour adresser des ressources spÃ©cifiques.</p>
<p>Dans le cas prÃ©sent, un contournement est possible via iptables : en effet, on peut supposer que lâinstance qui hÃ©bergera le reverse proxy et le site seront situÃ©s dans une mÃªme instance dâApache, et donc auront Ã  disposition le mÃªme kernel. De ce fait, on peut mettre Ã  profit une fonctionnalitÃ© de
marquage des paquets rÃ©seaux dâiptables, associÃ©e Ã  une condition sur lâorigine des paquets : on marquera sur la chaÃ®ne OUTPUT, sur le loopback, les paquets issus de www-data destinÃ©s au site drupal proprement dit, et on nâacceptera sur la chaÃ®ne INPUT, Ã  lâentrÃ©e du loopback et Ã  destination du site drupal, que des paquets dÃ»ment marquÃ©s. Un exemple de configuration est tel que suit :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>iptables<span class="w"> </span>-A<span class="w"> </span>OUTPUT<span class="w"> </span>-o<span class="w"> </span>lo<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dst<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>--src<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>--dport<span class="w"> </span><span class="m">444</span><span class="w"> </span>-m<span class="w"> </span>owner<span class="w"> </span>--uid-owner<span class="w"> </span>www-data<span class="w"> </span>-j<span class="w"> </span>MARK<span class="w"> </span>--set-mark<span class="w"> </span><span class="m">33</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-i<span class="w"> </span>lo<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dst<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>--src<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>--dport<span class="w"> </span><span class="m">444</span><span class="w"> </span>-m<span class="w"> </span>mark<span class="w"> </span>--mark<span class="w"> </span><span class="m">33</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">444</span><span class="w"> </span>-j<span class="w"> </span>DROP
</code></pre></div>
<p>Les paquets qui arrivent au serveur Drupal seront donc identifiÃ©s indirectement, ce qui permet ne plus avoir besoin du certificat SSL pour lâauthentification au niveau de Drupal. En revanche, le chiffrement des donnÃ©es reste toutefois requis.</p>
<p>On en arrive donc Ã  une configuration dâexemple comme la suivante :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nb">Listen</span><span class="w"> </span><span class="m">127.0.0.1</span>:444
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nt">&lt;VirtualHost</span><span class="w"> </span><span class="s">127.0.0.1:443</span><span class="nt">&gt;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="nb">LogLevel</span><span class="w"> </span><span class="k">debug</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="nb">CustomLog</span><span class="w"> </span><span class="s2">&quot;/var/log/apache2/debug_jm.log&quot;</span><span class="w"> </span><span class="s2">&quot;REMOTE_USER: %{REMOTE_USER}x SUBJECT_CN: % {SSL_CLIENT_S_DN_CN}x --- %v %h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="nb">ServerName</span><span class="w"> </span>drucomp2.test
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="nb">AddExternalAuth</span><span class="w"> </span>dea<span class="w"> </span><span class="s2">&quot;/home/ubuntu/DRUPAL_COMPOSER2/AUTH/externalauth.sh&quot;</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="nb">SetExternalAuthMethod</span><span class="w"> </span>dea<span class="w"> </span>pipe
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="nb">SSLEngine</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="nb">SSLCACertificateFile</span><span class="w"> </span><span class="s2">&quot;/etc/apache2/KEYS/ca.x509&quot;</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="nb">SSLCertificateFile</span><span class="w"> </span><span class="s2">&quot;pkcs11:model=SoftHSM%20v2;manufacturer=SoftHSM%20project;serial=75bb53774ddd60dc;token=serverhsm;object=servercert;type=cert&quot;</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="nb">SSLCertificateKeyFile</span><span class="w"> </span><span class="s2">&quot;pkcs11:model=SoftHSM%20v2;manufacturer=SoftHSM%20project;serial=75bb53774ddd60dc;token=serverhsm;object=serverkey;type=private&quot;</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="nb">SSLCipherSuite</span><span class="w"> </span>HIGH:!aNULL:!MD5
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="nb">SSLOptions</span><span class="w"> </span>+StrictRequire
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="nb">SSLProxyVerify</span><span class="w"> </span>require
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="c">#SSLProxyMachineCertificateFile &quot;/etc/apache2/KEYS/proxy_client.pem&quot;</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="nb">SSLProxyCACertificateFile</span><span class="w"> </span><span class="s2">&quot;/etc/apache2/KEYS/ca.x509&quot;</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a><span class="nt">&lt;Location</span><span class="w"> </span><span class="s">/</span><span class="nt">&gt;</span>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="nt">&lt;RequireAll&gt;</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="nb">Require</span><span class="w"> </span>ssl
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="nb">Require</span><span class="w"> </span>ssl-verify-client
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="nb">Require</span><span class="w"> </span>valid-user
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="nb">Require</span><span class="w"> </span>expr<span class="w"> </span>(%{REMOTE_USER}<span class="w"> </span>==<span class="w"> </span>%{SSL_CLIENT_S_DN_CN}<span class="w"> </span>)<span class="w"> </span>&amp;&amp;<span class="w"> </span>(-n<span class="w"> </span>%{REMOTE_USER})
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="nt">&lt;/RequireAll&gt;</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a><span class="nb">AuthType</span><span class="w"> </span>Basic
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="nb">AuthName</span><span class="w"> </span><span class="s2">&quot;Apache Level&quot;</span>
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="nb">AuthBasicProvider</span><span class="w"> </span>external
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="nb">AuthExternal</span><span class="w"> </span>dea
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a><span class="nb">AuthBasicAuthoritative</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="nb">ProxyPass</span><span class="w"> </span><span class="s2">&quot;https://drucomp2.test:444/&quot;</span>
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="nb">ProxyPassReverse</span><span class="w"> </span><span class="s2">&quot;https://drucomp2.test:444/&quot;</span>
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="nt">&lt;/Location&gt;</span>
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="nb">SSLProxyCheckPeerCN</span><span class="w"> </span><span class="k">On</span>
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a><span class="nb">SSLProxyCheckPeerName</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a><span class="nb">SSLProxyVerify</span><span class="w"> </span>require
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a><span class="nb">SSLProxyEngine</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a><span class="nb">SSLOptions</span><span class="w"> </span>+StrictRequire
<a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a><span class="nb">SSLVerifyClient</span><span class="w"> </span>require
<a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a><span class="nt">&lt;/VirtualHost&gt;</span>
<a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a><span class="nt">&lt;VirtualHost</span><span class="w"> </span><span class="s">127.0.0.1:444</span><span class="nt">&gt;</span>
<a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a><span class="nb">CustomLog</span><span class="w"> </span><span class="s2">&quot;/var/log/apache2/debug_jm_core.log&quot;</span><span class="w"> </span><span class="s2">&quot;REMOTE_USER: %{REMOTE_USER}x SUBJECT_CN:%{SSL_CLIENT_S_DN_CN}x --- %v %h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot;</span>
<a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a><span class="nb">LogLevel</span><span class="w"> </span><span class="k">debug</span>
<a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a><span class="nb">DocumentRoot</span><span class="w"> </span><span class="sx">/home/ubuntu/DRUPAL_COMPOSER2</span>
<a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a><span class="nb">ServerName</span><span class="w"> </span>drucomp2.test
<a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a><span class="nb">php_admin_value</span><span class="w"> </span>sendmail_path<span class="w"> </span><span class="s2">&quot;/usr/bin/env catchmail -f test@mailcatcher.test&quot;</span>
<a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a><span class="nb">php_admin_value</span><span class="w"> </span>CIVICRM_DB_CACHE_CLASS<span class="w"> </span>NoCache
<a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a><span class="nt">&lt;Directory</span><span class="w"> </span><span class="s">/home/ubuntu/DRUPAL_COMPOSER2</span><span class="nt">&gt;</span>
<a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a><span class="nb">SSLRequireSSL</span>
<a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a><span class="nb">Require</span><span class="w"> </span><span class="k">all</span><span class="w"> </span>granted
<a id="__codelineno-19-49" name="__codelineno-19-49" href="#__codelineno-19-49"></a><span class="nb">AllowOverride</span><span class="w"> </span><span class="k">All</span>
<a id="__codelineno-19-50" name="__codelineno-19-50" href="#__codelineno-19-50"></a><span class="nt">&lt;/Directory&gt;</span>
<a id="__codelineno-19-51" name="__codelineno-19-51" href="#__codelineno-19-51"></a><span class="nb">SSLEngine</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-19-52" name="__codelineno-19-52" href="#__codelineno-19-52"></a><span class="nb">SSLCACertificateFile</span><span class="w"> </span><span class="s2">&quot;/etc/apache2/KEYS/ca.x509&quot;</span>
<a id="__codelineno-19-53" name="__codelineno-19-53" href="#__codelineno-19-53"></a><span class="nb">SSLCertificateFile</span><span class="w"> </span><span class="s2">&quot;pkcs11:model=SoftHSM%20v2;manufacturer=SoftHSM%20project;serial=75bb53774ddd60dc;token=serverhsm;object=servercert;type=cert&quot;</span>
<a id="__codelineno-19-54" name="__codelineno-19-54" href="#__codelineno-19-54"></a><span class="nb">SSLCertificateKeyFile</span><span class="w"> </span><span class="s2">&quot;pkcs11:model=SoftHSM%20v2;manufacturer=SoftHSM%20project;serial=75bb53774ddd60dc;token=serverhsm;object=serverkey;type=private&quot;</span>
<a id="__codelineno-19-55" name="__codelineno-19-55" href="#__codelineno-19-55"></a><span class="nb">SSLCipherSuite</span><span class="w"> </span>HIGH:!aNULL:!MD5
<a id="__codelineno-19-56" name="__codelineno-19-56" href="#__codelineno-19-56"></a><span class="nb">SSLOptions</span><span class="w"> </span>+StrictRequire
<a id="__codelineno-19-57" name="__codelineno-19-57" href="#__codelineno-19-57"></a><span class="c">#SSLVerifyClient require</span>
<a id="__codelineno-19-58" name="__codelineno-19-58" href="#__codelineno-19-58"></a><span class="nt">&lt;/VirtualHost&gt;</span>
</code></pre></div>
<h4 id="prise-en-charge-hsm-au-niveau-du-navigateur"><a class="toclink" href="#prise-en-charge-hsm-au-niveau-du-navigateur">Prise en charge HSM au niveau du navigateur</a></h4>
<p>Firefox, dans ses prÃ©fÃ©rences, dispose dâun bouton pour appeler une interface de gestion des pÃ©riphÃ©riques de sÃ©curitÃ©. Il suffit ensuite de prÃ©ciser les modules dâinterfaÃ§age PKCS11 Ã  charger (par exemple /usr/lib/arm-linux-gnueabihf/softhsm/libsofthsm2.so ou /usr/lib/arm-linux-gnueabihf/libykcs11.so ). Ensuite, les certificats sont rendus disponibles du moment que lâutilisateur se connecte aux tokens.</p>
<p>En ce qui concerne chromium, la situation est plus compliquÃ©e : en thÃ©orie, chromium chercherait des informations dans une base NSS situÃ©e dans $HOME/.pki/nssdb. Cette base peut Ãªtre gÃ©rÃ©e par lâutilitaire modutil (package libnss3-tools), pour demander Ã  chromium de charger les mÃªmes
modules que ceux prÃ©sentÃ©s Ã  firefox. NÃ©anmoins, la version de chromium livrÃ©e avec Ubuntu est une version dans le format Â« snap Â» ; et le package, tel que configurÃ©, ne permet pas dâaccÃ©der au rÃ©pertoire nssdb. Ce problÃ¨me
est rÃ©pertoriÃ© chez Ubuntu
(<a href="https://bugs.launchpad.net/ubuntu/+source/chromium-browser/+bug/1899478">https://bugs.launchpad.net/ubuntu/+source/chromium-browser/+bug/1899478</a>
et
<a href="https://bugs.launchpad.net/ubuntu/+source/chromium-browser/+bug/1859643">https://bugs.launchpad.net/ubuntu/+source/chromium-browser/+bug/1859643</a> ). De plus, le montage de lâinterface home dans un snap devrait se limiter aux fichiers non cachÃ©s (donc qui ne commence pas par un point ) ; du coup, cela rend le problÃ¨me plus difficile Ã  rÃ©soudre, car le chemin de la BD NSS
semble Ãªtre en dur dans le code de chromium (<a href="https://github.com/chromium/chromium/blob/master/crypto/nss_util.cc">https://github.com/chromium/chromium/blob/master/crypto/nss_util.cc</a> ).</p>
<p>En conclusion, on remarque que les bÃ©nÃ©fices de lâidentification par certificat peuvent Ãªtre apprÃ©ciables, mais que ces bÃ©nÃ©fices ne peuvent Ãªtre acquis quâen mettant les ressources techniques, humaines, et matÃ©rielles en face. Enfin, on nâoubliera pas que lâauthentification par certificat peut Ã©galement Ãªtre mise en Åuvre dans certaines solutions VPN, ce qui signifie que cette technologie peut servir Ã  plusieurs niveaux. Des recherches complÃ©mentaires sur la gestion de CA et sur les VPN (au sens large) pourraient donc Ãªtre judicieuses.</p>
<h2 id="addendum-mise-en-cache-de-lauthentification"><a class="toclink" href="#addendum-mise-en-cache-de-lauthentification">Addendum : mise en cache de l'authentification</a></h2>
<p>L'intÃ©gration de l'authentification issue de Drupal avec Apache est coÃ»teuse : pour toute requÃªte envoyÃ©e au reverse-proxy, deux requÃªtes peuvent Ãªtre envoyÃ©es au serveur web interne : </p>
<ul>
<li>la requÃªte pour vÃ©rifier les identifiants</li>
<li>si l'authentification est valide, la requÃªte de base pour effectuer le travail proprement dit.</li>
</ul>
<p>En pratique, le maquettage a montrÃ© que ce systÃ¨me est particuliÃ¨rement impactant pour le bon fonctionnement du systÃ¨me, car il ne faut pas oublier que toute ressource va Ãªtre soumise Ã  authentification - dont les images. Il arrive donc que plus de resources soient nÃ©cessaires pour l'authentification que pour le travail demandÃ©.</p>
<p>Il ne faut par ailleurs pas oublier que dans le cadre d'un dÃ©ploiement Ã  grande Ã©chelle, cette consommation de ressources va impliquer plus de ressources nÃ©cessaires au fonctionnement du systÃ¨me, et donc des coÃ»ts plus importants.</p>
<p>Il s'avÃ¨re que <code>mod_authnz_external</code> dispose d'un nÃ©cessaire pour utiliser <code>mod_authn_socache</code> pour disposer d'un cache d'identifiants. Le cache utilisÃ© peut par exemple Ãªtre <code>mod_socache_shmcb</code>, qui va stocker les identifiants dans de la mÃ©moire partagÃ©e.</p>
<p>VÃ©rification faite dans le code de <code>authnz_external</code>, une fonction de la libapr est utilisÃ©e pour gÃ©nÃ©rer l'entrÃ©e en cache. Au niveau du cache, ce sera une empreinte SHA1 qui va Ãªtre stockÃ©e. La libapr permettrait quatre types d'identifiants :</p>
<ul>
<li>en clair</li>
<li>bcrypt</li>
<li>md5</li>
<li>sha1</li>
</ul>
<p>L'utilisation de SHA1 n'est plus considÃ©rÃ©e comme sÃ»re,ce qui amÃ¨ne Ã  dÃ©conseiller l'utilisation du cache Ã  cause de ce stockage du mot de passe. Toutefois, si l'authentification rÃ©alisÃ©e est une authentification Ã  facteurs multiples (dont une authentification forte), on pourrait toutefois considÃ©rer que l'importante du mot de passe n'est plus aussi forte, et que le risque devient un peu plus acceptable - mÃªme si une dÃ©cision politique doit clairement Ãªtre prise Ã  ce sujet avant mise en production.</p>
<p>En ce qui concerne la mise en cache de l'authentification, on peut considÃ©rer l'exemple suivant :</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nb">AuthnCacheEnable</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="nb">AuthnCacheSOCache</span><span class="w"> </span>shmcb
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="nt">&lt;VirtualHost</span><span class="w"> </span><span class="s">0.0.0.0:443</span><span class="nt">&gt;</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="nb">ServerName</span><span class="w"> </span>${SERVERNAME}
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="nb">AddExternalAuth</span><span class="w"> </span>dea<span class="w"> </span><span class="s2">&quot;/AUTH/externalauth.sh&quot;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="nb">SetExternalAuthMethod</span><span class="w"> </span>dea<span class="w"> </span>pipe
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="nb">SSLEngine</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="nb">SSLCertificateFile</span><span class="w"> </span>${SERVER_CERT}
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="nb">SSLCertificateKeyFile</span><span class="w"> </span>${SERVER_KEY}
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="nb">SSLCipherSuite</span><span class="w"> </span>HIGH:!aNULL:!MD5
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="nb">SSLOptions</span><span class="w"> </span>+StrictRequire
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="nb">SSLProxyVerify</span><span class="w"> </span>require
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="nb">SSLProxyMachineCertificateFile</span><span class="w"> </span>${PROXY_MACHINE_CERT}
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="nb">SSLProxyCACertificateFile</span><span class="w"> </span>${PROXY_CA}
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="nb">SSLProxyCheckPeerCN</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="nb">SSLProxyCheckPeerName</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="nb">SSLProxyVerify</span><span class="w"> </span>require
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="nb">SSLProxyEngine</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="nb">SSLOptions</span><span class="w"> </span>+StrictRequire
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="nb">SSLVerifyClient</span><span class="w"> </span><span class="k">none</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="nt">&lt;Location</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="nb">AuthExternalContext</span><span class="w"> </span>${AUTH_CONTEXT}
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="nt">&lt;RequireAll&gt;</span>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="nb">Require</span><span class="w"> </span>ssl
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="nb">Require</span><span class="w"> </span>valid-user
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="nt">&lt;/RequireAll&gt;</span>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="nb">AuthType</span><span class="w"> </span>Basic
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="nb">AuthName</span><span class="w"> </span><span class="s2">&quot;Civiparoisse&quot;</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="nb">AuthBasicProvider</span><span class="w"> </span>socache<span class="w"> </span>external
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="nb">AuthnCacheProvideFor</span><span class="w"> </span>external
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="nb">AuthExternalProvideCache</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="nb">AuthnCacheContext</span><span class="w"> </span>server
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a><span class="nb">AuthnCacheTimeout</span><span class="w"> </span><span class="m">300</span>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="nb">AuthExternal</span><span class="w"> </span>dea
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a><span class="nb">AuthBasicAuthoritative</span><span class="w"> </span><span class="k">on</span>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="nt">&lt;/Location&gt;</span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="nb">ProxyPass</span><span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="w"> </span><span class="s2">&quot;https://${INTERN_SERVERNAME}:444/&quot;</span>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="nt">&lt;/VirtualHost&gt;</span>
</code></pre></div>
<p>On constate la directive <code>AuthExternalProvideCache</code> qui va demander Ã  <code>authnz_external</code> de remplir le cache, et on constate qu'on a un provider d'authentification supplÃ©mentaire : socache, avec un timeout de 300secondes. Le contexte va agir sur la clef. On a encore deux directives globales qui dÃ©finissent le backend de cache utilisÃ©, et l'activation du cache.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Retour en haut de la page
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["search.suggest", "search.highlight", "search.share", "navigation.sections", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.footer", "toc.follow", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copi\u00e9 dans le presse-papier", "clipboard.copy": "Copier dans le presse-papier", "search.result.more.one": "1 de plus sur cette page", "search.result.more.other": "# de plus sur cette page", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.term.missing": "Non trouv\u00e9", "select.version": "S\u00e9lectionner la version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>